(executable
  (public_name act)
  (preprocess (pps ppx_jane))
  (libraries
    lib
    c
    x86
    core
    utils
    unix))

(rule
 (targets explain.regress.output)
 (action
  (with-stdout-to explain.regress.output
   (run act regress "explain" "tests")))
 (deps
  "tests/asm/x86/att/spec"
  (glob_files "tests/asm/x86/att/*.s"))
)
(alias
 (name runtest)
 (action (diff explain.regress.expected explain.regress.output)
))

(rule
 (targets litmusify.regress.output)
 (action
  (with-stdout-to litmusify.regress.output
   (run act regress "litmusify" "tests")))
 (deps
  "tests/asm/x86/att/spec"
  (glob_files "tests/asm/x86/att/*.s"))
)
(alias
 (name runtest)
 (action (diff litmusify.regress.expected litmusify.regress.output)
))

(rule
 (targets specs.output)
 (action
  (with-stdout-to specs.output
   (run act config "list-compilers" "-verbose" "-config" "act.conf.example")))
 (deps
  "act.conf.example")
)
(alias
 (name runtest)
 (action (diff specs.expected specs.output)
))