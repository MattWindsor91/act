(executable
  (public_name act)
  (preprocess (pps ppx_jane))
  (libraries
    lib
    c
    x86
    core
    utils
    unix))

(rule
 (targets regress.output)
 (action
  (with-stdout-to regress.output
   (run act regress "tests")))
 (deps
  "tests/asm/x86/att/spec"
  (glob_files "tests/asm/x86/att/*.s"))
)

(rule
 (targets specs.output)
 (action
  (with-stdout-to specs.output
   (run act config "list-compilers" "-verbose" "-config" "act.conf.example")))
 (deps
  "act.conf.example")
)

(alias
 (name runtest)
 (action (diff specs.expected specs.output)
))

(alias
 (name runtest)
 (action (diff regress.expected regress.output)
))
